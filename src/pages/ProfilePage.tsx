import { useEffect, useState, FormEvent } from "react";
import { createPortal } from "react-dom";
import { Link, useNavigate } from "react-router-dom";
import { Target, Users, Heart, FileText, Trash2, AlertTriangle, X, UserMinus } from "lucide-react";
import { useAuthStore } from "@/stores/authStore";
import { User } from "@/types";
import { notify } from "@/stores/notificationStore";
import { authService } from "@/services/authService";
import BackButton from "@/components/common/BackButton";
import ConfirmationDialog from "@/components/common/ConfirmationDialog";
import { getItem, setItem } from "@/services/storageService";
import { getLocalRecordingIds, getLocalRecordingFull, setLocalRecording, clearAllLocalRecordings } from "@/services/recordingStorage";
import { accountDeletionService } from "@/services/accountDeletionService";

export default function ProfilePage() {
  const { user, setUser, logout } = useAuthStore();
  const navigate = useNavigate();
  const [showDeleteMetadataConfirm, setShowDeleteMetadataConfirm] = useState(false);
  const [showDeleteAccountConfirm, setShowDeleteAccountConfirm] = useState(false);

  // Edit profile modal state
  const [isEditOpen, setIsEditOpen] = useState(false);
  const [formFullName, setFormFullName] = useState("");
  const [formUsername, setFormUsername] = useState("");
  const [formEmail, setFormEmail] = useState("");

  // Validation state
  const [touchedFullName, setTouchedFullName] = useState(false);
  const [touchedUsername, setTouchedUsername] = useState(false);
  const [touchedEmail, setTouchedEmail] = useState(false);
  const [errors, setErrors] = useState<{ fullName?: string; username?: string; email?: string }>({});

  const validate = () => {
    const e: { fullName?: string; username?: string; email?: string } = {};
    const fullNameTrim = formFullName.trim();
    if (!fullNameTrim) e.fullName = "Họ và tên là bắt buộc.";
    else if (fullNameTrim.length < 2) e.fullName = "Họ và tên phải có ít nhất 2 ký tự.";

    const usernameTrim = formUsername.trim();
    if (!usernameTrim) e.username = "Tên người dùng là bắt buộc.";
    else if (!/^[a-zA-Z0-9_]{3,20}$/.test(usernameTrim)) e.username = "Tên người dùng 3-20 ký tự, chỉ chữ, số và dấu gạch dưới.";

    const emailTrim = formEmail.trim();
    if (!emailTrim) e.email = "Email là bắt buộc.";
    else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailTrim)) e.email = "Email không hợp lệ.";

    setErrors(e);
    return Object.keys(e).length === 0;
  };

  const isValidSnapshot = () => {
    const fullNameTrim = formFullName.trim();
    const usernameTrim = formUsername.trim();
    const emailTrim = formEmail.trim();
    return (
      fullNameTrim.length >= 2 &&
      /^[a-zA-Z0-9_]{3,20}$/.test(usernameTrim) &&
      /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailTrim)
    );
  };

  const openEdit = () => {
    setFormFullName(user?.fullName || "");
    setFormUsername(user?.username || "");
    setFormEmail(user?.email || "");
    // reset validation
    setTouchedFullName(false);
    setTouchedUsername(false);
    setTouchedEmail(false);
    setErrors({});
    setIsEditOpen(true);
  };

  const handleSaveProfile = async (e: FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    if (!user) return;
    setTouchedFullName(true);
    setTouchedUsername(true);
    setTouchedEmail(true);
    if (!validate()) {
      notify.error("Lỗi", "Vui lòng sửa các lỗi trong biểu mẫu trước khi lưu.");
      return;
    }

    const updated: User = {
      ...user,
      fullName: formFullName.trim(),
      username: formUsername.trim(),
      email: formEmail.trim(),
    };

    // If authenticated with real backend, try to persist remotely
    if (authService.isAuthenticated()) {
      try {
        const res = await authService.updateProfile({
          fullName: updated.fullName,
          username: updated.username,
          email: updated.email,
        });
        if (res && res.data) {
          const serverUser = res.data as User;
          void setItem("user", JSON.stringify(serverUser));
          setUser(serverUser);
        } else {
          // fallback to local update
          void setItem("user", JSON.stringify(updated));
          setUser(updated);
        }
      } catch (err) {
        console.error("Failed to save profile on server", err);
        // Queue update for background retry and persist locally
        authService.queuePendingProfileUpdate(updated.id, {
          fullName: updated.fullName,
          username: updated.username,
          email: updated.email,
        });
        void setItem("user", JSON.stringify(updated));
        setUser(updated);
        // Inform user that changes were saved locally and queued for sync
        notify.info(
          "Thông báo",
          "Không thể lưu hồ sơ lên server ngay bây giờ. Thay đổi đã được lưu cục bộ và sẽ tự động đồng bộ khi có kết nối.",
        );
      }
    } else {
      // Local/demo mode: persist locally and into overrides so it survives logout/login demo
      void setItem("user", JSON.stringify(updated));
      setUser(updated);

      try {
        const oRaw = getItem("users_overrides");
        const overrides = oRaw ? (JSON.parse(oRaw) as Record<string, User>) : {};
        if (updated.id) {
          overrides[updated.id] = updated;
          void setItem("users_overrides", JSON.stringify(overrides));
        }
      } catch (err) {
        console.error("Failed to write user override", err);
      }
    }

    // Propagate changes to local recordings uploaded by this user (per-recording → no OOM)
    try {
      const ids = await getLocalRecordingIds();
      for (const recId of ids) {
        const full = await getLocalRecordingFull(recId);
        if (full && full.uploader && (full.uploader as { id?: string }).id === updated.id) {
          const merged = {
            ...full,
            uploader: { ...full.uploader, username: updated.username },
          };
          await setLocalRecording(merged);
        }
      }
    } catch (err) {
      console.error("Failed to propagate user updates to localRecordings", err);
    }

    setIsEditOpen(false);
    notify.success("Thành công", "Lưu hồ sơ thành công");
  };

  // Helper: normalize role to friendly Vietnamese label
  const formatRole = (r?: string) => {
    if (!r) return "Khách";
    const s = String(r).toLowerCase();
    if (s === "expert" || s.includes("expert")) return "Chuyên gia";
    if (s === "contributor" || s.includes("contrib")) return "Người đóng góp";
    return r.charAt(0).toUpperCase() + r.slice(1).toLowerCase();
  };

  const handleDeleteAccountConfirm = async () => {
    if (!user) return;
    try {
      if (user.role === "CONTRIBUTOR") {
        await accountDeletionService.deleteAccountContributor(user.id);
        logout();
        navigate("/login", { replace: true });
        notify.success("Thành công", "Tài khoản đã được xóa khỏi hệ thống.");
      } else if (user.role === "EXPERT") {
        await accountDeletionService.requestExpertAccountDeletion({
          expertId: user.id,
          expertUsername: user.username,
          expertFullName: user.fullName,
        });
        setShowDeleteAccountConfirm(false);
        notify.success("Thành công", "Yêu cầu xóa tài khoản đã được gửi đến Quản trị viên. Bạn sẽ được xóa khỏi hệ thống sau khi được duyệt.");
      }
    } catch (err) {
      console.error("Delete account error:", err);
      notify.error("Lỗi", "Không thể xử lý yêu cầu. Vui lòng thử lại.");
    }
  };

  // Disable body scroll when dialogs are open
  useEffect(() => {
    if (isEditOpen || showDeleteMetadataConfirm || showDeleteAccountConfirm) {
      // Save current scroll position
      const scrollY = window.scrollY;
      document.body.style.position = 'fixed';
      document.body.style.top = `-${scrollY}px`;
      document.body.style.width = '100%';
      document.body.style.overflow = 'hidden';
    } else {
      // Restore scroll position
      const scrollY = document.body.style.top;
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.width = '';
      document.body.style.overflow = '';
      if (scrollY) {
        window.scrollTo(0, parseInt(scrollY || '0') * -1);
      }
    }
    return () => {
      // Cleanup
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.width = '';
      document.body.style.overflow = '';
    };
  }, [isEditOpen, showDeleteMetadataConfirm, showDeleteAccountConfirm]);

  // Handle ESC key to close dialogs
  useEffect(() => {
    if (!isEditOpen && !showDeleteMetadataConfirm && !showDeleteAccountConfirm) return;

    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') {
        if (isEditOpen) setIsEditOpen(false);
        if (showDeleteMetadataConfirm) setShowDeleteMetadataConfirm(false);
        if (showDeleteAccountConfirm) setShowDeleteAccountConfirm(false);
      }
    };

    document.addEventListener('keydown', handleEscape);
    return () => document.removeEventListener('keydown', handleEscape);
  }, [isEditOpen, showDeleteMetadataConfirm, showDeleteAccountConfirm]);


  const handleDeleteAllMetadata = async () => {
    try {
      const ids = await getLocalRecordingIds();
      const deletedCount = ids.length;
      if (deletedCount === 0) {
        notify.success("Thông báo", "Không có dữ liệu để xóa");
        return;
      }
      await clearAllLocalRecordings();
      notify.success("Thành công", `Đã xóa thành công ${deletedCount} bản thu.`);
      setShowDeleteMetadataConfirm(false);
    } catch (err) {
      console.error("Lỗi khi xóa metadata:", err);
      notify.error("Lỗi", "Có lỗi xảy ra khi xóa metadata. Vui lòng thử lại.");
    }
  };

  return (
    <div className="min-h-screen">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="flex flex-wrap items-center justify-between gap-2 sm:gap-3 mb-6 sm:mb-8">
          <h1 className="text-xl sm:text-3xl font-bold text-neutral-900 min-w-0">Hồ sơ</h1>
          <BackButton />
        </div>

        <div className="prose max-w-none">
          <div className="rounded-2xl border border-neutral-200/80 shadow-lg backdrop-blur-sm p-8 mb-8 transition-all duration-300 hover:shadow-xl" style={{ backgroundColor: '#FFFCF5' }}>
            <div className="flex items-start justify-between">
              <h2 className="text-2xl font-semibold mb-4 text-neutral-900">Thông tin tài khoản</h2>
              <button type="button" onClick={openEdit} className="px-4 py-2 rounded-full bg-secondary-100/90 hover:bg-secondary-200/90 text-secondary-800 font-medium transition-all duration-200 shadow-sm hover:shadow-md hover:scale-105 active:scale-95 cursor-pointer">Chỉnh sửa hồ sơ</button>
            </div>

            <p className="text-neutral-700 font-medium leading-relaxed mb-4">
              <strong>Tên:</strong> {user?.fullName || user?.username} <br />
              <strong>Vai trò:</strong> {formatRole(user?.role)} <br />
              <strong>Email:</strong> {user?.email || '—'}
            </p>
            <p className="text-neutral-700 font-medium leading-relaxed">
              Tại đây bạn có thể quản lý thông tin cá nhân và theo dõi trạng thái các đóng góp mà bạn đã gửi tới VietTune.
            </p>
          </div>

          {/* Edit Profile Modal */}
          {isEditOpen && createPortal(
            <div
              className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity duration-300 pointer-events-auto"
              onClick={(e) => { if (e.target === e.currentTarget) setIsEditOpen(false); }}
              style={{
                animation: 'fadeIn 0.3s ease-out',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                width: '100vw',
                height: '100vh',
                position: 'fixed',
              }}
            >
              <div
                className="rounded-2xl border border-neutral-300/80 shadow-2xl backdrop-blur-sm max-w-lg w-full p-6 pointer-events-auto transform"
                style={{
                  backgroundColor: '#FFF2D6',
                  animation: 'slideUp 0.3s ease-out'
                }}
                onClick={(e) => e.stopPropagation()}
              >
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-lg font-semibold text-neutral-900">Chỉnh sửa hồ sơ</h3>
                  <button
                    onClick={() => setIsEditOpen(false)}
                    className="p-1.5 rounded-full hover:bg-neutral-200/50 transition-colors duration-200 text-neutral-600 hover:text-neutral-800 cursor-pointer"
                    aria-label="Đóng"
                  >
                    <X className="h-5 w-5" strokeWidth={2.5} />
                  </button>
                </div>
                <form onSubmit={handleSaveProfile} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-neutral-800 mb-2">Họ và tên</label>
                    <input
                      type="text"
                      value={formFullName}
                      onChange={(e) => { setFormFullName(e.target.value); if (touchedFullName) validate(); }}
                      onBlur={() => { setTouchedFullName(true); validate(); }}
                      className="w-full px-5 py-3 text-neutral-900 placeholder-neutral-500 border border-neutral-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors rounded-full"
                      style={{ backgroundColor: '#FFFCF5' }}
                    />
                    {touchedFullName && errors.fullName && <p className="text-sm text-red-600 mt-1">{errors.fullName}</p>}
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-neutral-800 mb-2">Tên người dùng</label>
                    <input
                      type="text"
                      value={formUsername}
                      onChange={(e) => { setFormUsername(e.target.value); if (touchedUsername) validate(); }}
                      onBlur={() => { setTouchedUsername(true); validate(); }}
                      className="w-full px-5 py-3 text-neutral-900 placeholder-neutral-500 border border-neutral-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors rounded-full"
                      style={{ backgroundColor: '#FFFCF5' }}
                    />
                    {touchedUsername && errors.username && <p className="text-sm text-red-600 mt-1">{errors.username}</p>}
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-neutral-800 mb-2">Email</label>
                    <input
                      type="email"
                      value={formEmail}
                      onChange={(e) => { setFormEmail(e.target.value); if (touchedEmail) validate(); }}
                      onBlur={() => { setTouchedEmail(true); validate(); }}
                      className="w-full px-5 py-3 text-neutral-900 placeholder-neutral-500 border border-neutral-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors rounded-full"
                      style={{ backgroundColor: '#FFFCF5' }}
                    />
                    {touchedEmail && errors.email && <p className="text-sm text-red-600 mt-1">{errors.email}</p>}
                  </div>

                  <div className="flex justify-end gap-3">
                    <button type="button" onClick={() => setIsEditOpen(false)} className="px-4 py-2 rounded-full bg-neutral-200/80 hover:bg-neutral-300 text-neutral-800 font-medium transition-all duration-200 shadow-md hover:shadow-lg hover:scale-105 active:scale-95 cursor-pointer">Hủy</button>
                    <button disabled={!isValidSnapshot()} type="submit" className="px-4 py-2 rounded-full bg-gradient-to-br from-primary-600 to-primary-700 hover:from-primary-500 hover:to-primary-600 text-white font-medium transition-all duration-300 shadow-xl hover:shadow-2xl shadow-primary-600/40 hover:scale-110 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100">Lưu</button>
                  </div>
                </form>
              </div>
            </div>, document.body)}

          <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <div className="rounded-2xl border border-neutral-200/80 shadow-lg backdrop-blur-sm p-6 transition-all duration-300 hover:shadow-xl" style={{ backgroundColor: '#FFFCF5' }}>
              <div className="bg-primary-100/90 rounded-full w-12 h-12 flex items-center justify-center mb-4 shadow-sm">
                <Target className="h-6 w-6 text-primary-600" strokeWidth={2.5} />
              </div>
              <h3 className="text-xl font-semibold mb-3 text-neutral-900">Giới thiệu bản thân</h3>
              <p className="text-neutral-700 font-medium">Một nơi để giới thiệu bản thân, chia sẻ động lực đóng góp và tôn vinh truyền thống âm nhạc của cộng đồng.</p>
            </div>

            <div className="rounded-2xl border border-neutral-200/80 shadow-lg backdrop-blur-sm p-6 transition-all duration-300 hover:shadow-xl" style={{ backgroundColor: '#FFFCF5' }}>
              <div className="bg-secondary-100/90 rounded-full w-12 h-12 flex items-center justify-center mb-4 shadow-sm">
                <Users className="h-6 w-6 text-secondary-600" strokeWidth={2.5} />
              </div>
              <h3 className="text-xl font-semibold mb-3 text-neutral-900">Sức mạnh cộng đồng</h3>
              <p className="text-neutral-700 font-medium">Kết nối với chuyên gia và người yêu nhạc để xác minh, duy trì và lan tỏa giá trị văn hóa.</p>
            </div>
          </div>

          <div className="rounded-2xl border border-neutral-200/80 p-6 mb-8 shadow-lg backdrop-blur-sm transition-all duration-300 hover:shadow-xl" style={{ backgroundColor: '#FFFCF5' }}>
            <div className="bg-primary-100/90 rounded-full w-12 h-12 flex items-center justify-center mb-4 shadow-sm">
              <Heart className="h-6 w-6 text-primary-600" strokeWidth={2.5} />
            </div>
            <h3 className="text-xl font-semibold mb-3 text-neutral-900">Mục tiêu</h3>
            <p className="text-neutral-700 font-medium">Hỗ trợ việc thu thập, lưu trữ và phổ biến các bản thu truyền thống theo chuẩn khoa học và tôn trọng bản quyền.</p>
          </div>

          {/* Admin Tools - Xóa metadata (chỉ hiển thị trong Hồ sơ của admin) */}
          {user?.role === "ADMIN" && (
            <div className="rounded-2xl border border-neutral-200/80 shadow-lg backdrop-blur-sm p-8 mb-8 transition-all duration-300 hover:shadow-xl" style={{ backgroundColor: '#FFFCF5' }}>
              <div className="flex items-start justify-between mb-4">
                <div>
                  <h2 className="text-2xl font-semibold mb-2 text-neutral-900">Công cụ quản trị</h2>
                  <p className="text-neutral-700 font-medium text-sm">
                    Xóa toàn bộ dữ liệu từ các bản thu để giải phóng dung lượng lưu trữ.
                    Tất cả thông tin sẽ bị xóa hoàn toàn, bao gồm metadata, media, và cả thông tin hệ thống (ID, thời điểm tải lên, trạng thái kiểm duyệt, người đóng góp).
                  </p>
                </div>
              </div>
              <button
                onClick={() => setShowDeleteMetadataConfirm(true)}
                className="px-4 py-2 rounded-full bg-gradient-to-br from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white font-medium transition-all duration-300 shadow-xl hover:shadow-2xl shadow-red-600/40 hover:scale-110 active:scale-95 cursor-pointer flex items-center gap-2"
              >
                <Trash2 className="w-4 h-4" strokeWidth={2.5} />
                Xóa toàn bộ metadata
              </button>
            </div>
          )}

          {/* Delete account (Contributor & Expert) */}
          {(user?.role === "CONTRIBUTOR" || user?.role === "EXPERT") && (
            <div className="rounded-2xl border border-neutral-200/80 shadow-lg backdrop-blur-sm p-8 mb-8 transition-all duration-300 hover:shadow-xl" style={{ backgroundColor: '#FFFCF5' }}>
              <div className="flex items-start justify-between mb-4">
                <div>
                  <h2 className="text-2xl font-semibold mb-2 text-neutral-900">Xoá tài khoản</h2>
                  <p className="text-neutral-700 font-medium text-sm">
                    {user.role === "CONTRIBUTOR"
                      ? "Xóa tài khoản sẽ đăng xuất và xóa dữ liệu tài khoản khỏi hệ thống. Hành động không thể hoàn tác."
                      : "Chuyên gia xóa tài khoản cần được Quản trị viên duyệt. Sau khi duyệt, tài khoản sẽ bị xóa khỏi hệ thống."}
                  </p>
                </div>
              </div>
              <button
                type="button"
                onClick={() => setShowDeleteAccountConfirm(true)}
                className="px-4 py-2 rounded-full bg-gradient-to-br from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white font-medium transition-all duration-300 shadow-xl hover:shadow-2xl shadow-red-600/40 hover:scale-110 active:scale-95 cursor-pointer flex items-center gap-2"
              >
                <UserMinus className="w-4 h-4" strokeWidth={2.5} />
                Xoá tài khoản
              </button>
            </div>
          )}

          {/* Terms and Conditions Link */}
          <div className="rounded-2xl border border-neutral-200/80 shadow-lg backdrop-blur-sm p-8 text-center transition-all duration-300 hover:shadow-xl" style={{ backgroundColor: '#FFFCF5' }}>
            <div className="bg-neutral-100/90 rounded-full w-12 h-12 flex items-center justify-center mb-4 mx-auto shadow-sm">
              <FileText className="h-6 w-6 text-neutral-600" strokeWidth={2.5} />
            </div>
            <h3 className="text-xl font-semibold mb-3 text-neutral-900">Điều khoản và Điều kiện</h3>
            <p className="text-neutral-700 font-medium mb-6">Tìm hiểu các quy định và chính sách khi sử dụng nền tảng VietTune.</p>
            <Link
              to="/terms"
              className="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-br from-primary-600 to-primary-700 hover:from-primary-500 hover:to-primary-600 text-white font-semibold rounded-full transition-all duration-300 shadow-xl hover:shadow-2xl shadow-primary-600/40 hover:scale-110 active:scale-95 cursor-pointer"
            >
              <FileText className="h-5 w-5" strokeWidth={2.5} />
              Xem Điều khoản và Điều kiện
            </Link>
          </div>
        </div>
      </div>

      {/* Delete Account Confirmation Dialog */}
      <ConfirmationDialog
        isOpen={showDeleteAccountConfirm}
        onClose={() => setShowDeleteAccountConfirm(false)}
        onConfirm={handleDeleteAccountConfirm}
        title="Xác nhận xóa tài khoản"
        message={
          user?.role === "CONTRIBUTOR"
            ? "Bạn có chắc chắn muốn xóa tài khoản khỏi hệ thống?"
            : "Bạn có chắc chắn muốn gửi yêu cầu xóa tài khoản đến Quản trị viên?"
        }
        description={
          user?.role === "CONTRIBUTOR"
            ? "Tài khoản và dữ liệu liên quan sẽ bị xóa. Hành động này không thể hoàn tác."
            : "Sau khi Quản trị viên duyệt, tài khoản của bạn sẽ bị xóa khỏi hệ thống."
        }
        confirmText={user?.role === "CONTRIBUTOR" ? "Xóa tài khoản" : "Gửi yêu cầu"}
        cancelText="Hủy"
        confirmButtonStyle="bg-red-600 text-white hover:bg-red-500"
      />

      {/* Delete Metadata Confirmation Dialog */}
      {showDeleteMetadataConfirm && createPortal(
        <div
          className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity duration-300 pointer-events-auto"
          onClick={(e) => { if (e.target === e.currentTarget) setShowDeleteMetadataConfirm(false); }}
          style={{
            animation: 'fadeIn 0.3s ease-out',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            width: '100vw',
            height: '100vh',
            position: 'fixed',
          }}
        >
          <div
            className="rounded-2xl border border-neutral-300/80 shadow-2xl backdrop-blur-sm max-w-lg w-full p-6 pointer-events-auto transform"
            style={{
              backgroundColor: '#FFF2D6',
              animation: 'slideUp 0.3s ease-out'
            }}
            onClick={(e) => e.stopPropagation()}
          >
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-red-100/90 rounded-full shadow-sm">
                  <AlertTriangle className="h-6 w-6 text-red-600" strokeWidth={2.5} />
                </div>
                <h3 className="text-lg font-semibold text-neutral-900">Xác nhận xóa toàn bộ dữ liệu</h3>
              </div>
              <button
                onClick={() => setShowDeleteMetadataConfirm(false)}
                className="p-1.5 rounded-full hover:bg-neutral-200/50 transition-colors duration-200 text-neutral-600 hover:text-neutral-800 cursor-pointer"
                aria-label="Đóng"
              >
                <X className="h-5 w-5" strokeWidth={2.5} />
              </button>
            </div>
            <p className="text-neutral-700 font-medium mb-6">
              Bạn có chắc chắn muốn xóa toàn bộ dữ liệu từ tất cả các bản thu không?
              Hành động này sẽ giải phóng dung lượng lưu trữ và xóa hoàn toàn tất cả các bản thu.
              <br /><br />
              <strong>Lưu ý:</strong> Tất cả thông tin sẽ bị xóa hoàn toàn, bao gồm:
              <ul className="list-disc list-inside mt-2 space-y-1">
                <li>Thông tin cơ bản: tiêu đề, nghệ sĩ, thể loại, ngày ghi âm, địa điểm</li>
                <li>Bối cảnh văn hóa: dân tộc, vùng miền, loại sự kiện, nhạc cụ</li>
                <li>Ghi chú bổ sung: mô tả, ghi chú thực địa, bản chép nhạc</li>
                <li>Thông tin quản trị: người thu thập, bản quyền, mã catalog</li>
                <li>File media: audioData, videoData, youtubeUrl, mediaType, file</li>
                <li>Thông tin hệ thống: ID, thời điểm tải lên, trạng thái kiểm duyệt, người đóng góp</li>
              </ul>
              <br />
              <strong className="text-red-600">Hành động này không thể hoàn tác!</strong>
            </p>
            <div className="flex justify-end gap-3">
              <button
                onClick={() => setShowDeleteMetadataConfirm(false)}
                className="px-4 py-2 rounded-full bg-neutral-200/80 hover:bg-neutral-300 text-neutral-800 font-medium transition-all duration-200 shadow-md hover:shadow-lg hover:scale-105 active:scale-95 cursor-pointer"
              >
                Hủy
              </button>
              <button
                onClick={handleDeleteAllMetadata}
                className="px-4 py-2 rounded-full bg-gradient-to-br from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white font-medium transition-all duration-300 shadow-xl hover:shadow-2xl shadow-red-600/40 hover:scale-110 active:scale-95 cursor-pointer flex items-center gap-2"
              >
                <Trash2 className="w-4 h-4" strokeWidth={2.5} />
                Xóa toàn bộ dữ liệu
              </button>
            </div>
          </div>
        </div>, document.body
      )}
    </div>
  );
}
